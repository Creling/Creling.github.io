title: ztsh项目完成后的一些感悟
url: 456.html
id: 456
categories:
  - Linux &amp; VPS
date: 2019-07-13 15:31:37
tags:
---
因为接了腾讯的兼职任务，之前一段时间一直在做一个反向代理的管理平台，项目完成之后也积累了一些感悟，特此记录，免得日后忘却。
<!--more-->

正文
--

### 阶段一

这段时间，目标主要是对标nc，也就是bash+管道重定向，相对而言比较简单，主要涉及了 - Django框架的使用 - xtermjs前端库的使用 - jinja2模板渲染引擎的使用 - websocket的接触与使用（django的channels模块） 大概花了三天完成了主要工作，前端设计套用了现成的模板。但和腾讯方接触的时候，发现不符合要求。单纯的管道重定向无法支持sudo，vim等操作，于是废弃之前的代码，从伪终端入手，重构整个项目。

### 阶段二

主要学习了伪终端，了解伪终端的时候查看了这篇文章，帮助很大，[Linux 的伪终端的基本原理 及其在远程登录（SSH，telnet等）中的应用](https://www.cnblogs.com/zzdyyy/p/7538077.html)，主要是对伪终端有了一个概念。 后来查阅相关资料，准备用python完成伪终端的制作，却发现python关于这方面的资料很少，最终决定修改GitHub上的[orangetw/tsh](https://github.com/orangetw/tsh)项目。 修改项目的过程中遇到了一些坑，也给我提了一个醒： **修改项目之前一定要通读全项目，不要觉得看懂了项目的逻辑就开始修改，不然你永远不知道项目哪里是不是有一行代码会坑你！！** 遇到过一个问题，在一个线程中accept一个socket，然后recv没有问题，结果把这个socket传送到其他线程再recv就出现了问题，debug了很久，最终发现recv的wrapper有一个alarm定时器，传送socket的过程已经超时了。