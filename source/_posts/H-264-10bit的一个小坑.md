title: H.264-10bit编码的一个小坑及解决方案
author: Creling
toc: true
date: 2019-12-17 21:28:20
tags:

---
**摘要** 前两天在向我的网站上传动漫，发现一部H.264格式的视频无法在Firefox上正常播放，但是可以在Chrome上正常播放，百思不得其解。最终自仔细比对了视频流的格式，发现原因在于那部动漫是10bit编码，而Firefox并不支持10bit编码的H.264.

## 1. 问题根源
```ini
[STREAM]
index=0
codec_name=h264
codec_long_name=H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10
profile=High 10
codec_type=video
codec_time_base=1001/48000
codec_tag_string=avc1
codec_tag=0x31637661
width=1920
height=1080
coded_width=1920
coded_height=1088
has_b_frames=2
sample_aspect_ratio=1:1
display_aspect_ratio=16:9
pix_fmt=yuv420p10le
level=40
color_range=unknown
color_space=unknown
color_transfer=unknown
color_primaries=unknown
chroma_location=left
field_order=unknown
timecode=N/A
refs=1
is_avc=true
nal_length_size=4
id=N/A
r_frame_rate=24000/1001
avg_frame_rate=24000/1001
time_base=1/24000
start_pts=0
start_time=0.000000
duration_ts=36984948
duration=1541.039500
bit_rate=1244781
max_bit_rate=N/A
bits_per_raw_sample=10
nb_frames=36948
nb_read_frames=N/A
nb_read_packets=N/A
DISPOSITION:default=1
DISPOSITION:dub=0
DISPOSITION:original=0
DISPOSITION:comment=0
DISPOSITION:lyrics=0
DISPOSITION:karaoke=0
DISPOSITION:forced=0
DISPOSITION:hearing_impaired=0
DISPOSITION:visual_impaired=0
DISPOSITION:clean_effects=0
DISPOSITION:attached_pic=0
DISPOSITION:timed_thumbnails=0
TAG:language=und
TAG:handler_name=VideoHandler
[/STREAM]
```
关键点有两条
- `profile=High 10`
- `pix_fmt=yuv420p10le`  

都说明这是10bit编码的视频。

## 2. 解决方案
发现问题后解决起来也就容易了，只需要将10bit编码转换为8bit编码，在ffmpeg参数中添加`-pix_fmt yuv420p`即可。
